<!DOCTYPE html>
<html>

<head>
    <title>My Second Web Page</title>
</head>

<body>
    <h1>Welcome to my second web page!</h1>
    <p>This is a paragraph of text.</p>
    <p>This is another paragraph of text.</p>
</body>

<script>
    // Get the code from the URL
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');

    // Exchange the code for an access token
    const myHeaders = new Headers();
    const formdata = new FormData();
    formdata.append("client_id", "125585");
    formdata.append("client_secret", "73c852a5a0215f5947cea3a2f906cbf5cccf044d");
    formdata.append("code", code);
    formdata.append("grant_type", "authorization_code");

    const requestOptions = {
        method: "POST",
        headers: myHeaders,
        body: formdata,
        redirect: "follow"
    };

    var txt = undefined;
    var json = undefined;

    fetch("https://www.strava.com/oauth/token", requestOptions)
        .then((response) => response.text())
        .then((result) => parseResponse(result))
        .catch((error) => console.error(error));

    function parseResponse(response) {
        txt = response;
        json = JSON.parse(txt);
        console.log(json);
        // console.log(json.access_token);

        // Save the access_token & refresh_token to local storage
        localStorage.setItem('access_token', json.access_token);
        localStorage.setItem('refresh_token', json.refresh_token);

        // redirect to the index page
        window.location.href = 'http://localhost:8000/index.html?access_token=' + json.access_token;

    }

</script>

</html>